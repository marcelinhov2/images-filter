// Generated by CoffeeScript 1.6.3
var Camera,Filter,__bind=function(e,t){return function(){return e.apply(t,arguments)}};Filter=function(){function e(){}e.prototype.getPixels=function(e){var t;t=e.canvas;return e.getImageData(0,0,t.width,t.height)};e.prototype.filterImage=function(e,t,n){var r,i;r=[this.getPixels(t)];i=2;while(i<arguments.length){r.push(arguments[i]);i++}return e.apply(null,r)};e.prototype.grayscale=function(e,t){var n,r,i,s,o,u;r=e.data;s=0;while(s<r.length){o=r[s];i=r[s+1];n=r[s+2];u=.2126*o+.7152*i+.0722*n;r[s]=r[s+1]=r[s+2]=u;s+=4}return e};e.prototype.brightness=function(e,t){var n,r;n=e.data;r=0;while(r<n.length){n[r]+=t;n[r+1]+=t;n[r+2]+=t;r+=4}return e};e.prototype.threshold=function(e,t){var n,r,i,s,o,u;r=e.data;s=0;while(s<r.length){o=r[s];i=r[s+1];n=r[s+2];u=.2126*o+.7152*i+.0722*n>=t?255:0;r[s]=r[s+1]=r[s+2]=u;s+=4}return e};return e}();Camera=function(){function e(){this.errorCallback=__bind(this.errorCallback,this);this.successCallback=__bind(this.successCallback,this);this.draw=__bind(this.draw,this);this.start=__bind(this.start,this)}navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia;e.prototype.init=function(e,t){this.videoElement=e;this.canvasElement=t;this.context=this.canvasElement.getContext("2d");this.filter=new Filter;return this.checkBrowserSupport()};e.prototype.checkBrowserSupport=function(){var e=this;if(typeof MediaStreamTrack=="undefined")return alert("This browser does not support MediaStreamTrack.\n\nTry Chrome Canary.");MediaStreamTrack.getSources(this.start);setTimeout(function(){return e.draw()},5e3);return this.set_triggers()};e.prototype.set_triggers=function(){var e=this;$("#print").click(this.draw);$("#grayscale").click(function(){return e.runFilter(e.filter.grayscale)});$("#brightness").click(function(){return e.runFilter(e.filter.brightness,40)});return $("#threshold").click(function(){return e.runFilter(e.filter.threshold,128)})};e.prototype.start=function(e){var t,n;n=_.find(e,{kind:"video"});if(!!window.stream){this.videoElement.src=null;window.stream.stop()}t={video:{optional:[{sourceId:n}]}};return navigator.getUserMedia(t,this.successCallback,this.errorCallback)};e.prototype.draw=function(){var e;if(this.videoElement.paused||this.videoElement.ended)return!1;this.context.drawImage(this.videoElement,0,0,this.canvasElement.width,this.canvasElement.height);e=this.canvasElement.toDataURL("image/png");return this.filter.getPixels(this.context)};e.prototype.successCallback=function(e){window.stream=e;this.videoElement.src=window.URL.createObjectURL(e);return this.videoElement.play()};e.prototype.errorCallback=function(e){return console.log("navigator.getUserMedia error: ",e)};e.prototype.runFilter=function(e,t){var n;t?n=this.filter.filterImage(e,this.context,t):n=this.filter.filterImage(e,this.context);return this.context.putImageData(n,0,0)};return e}();$(document).ready(function(){var e,t,n;t=$("#canvas")[0];n=$("#webcam")[0];e=new Camera;return e.init(n,t)});